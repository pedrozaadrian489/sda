Vue.component("status-handler",{name:"status-handler",template:'<div id="statusHandler"><alert id="resultHandlerAlert" :class="{\'alert-new-size-sbl-login\':service == \'login\'}" v-model="resultAlert" ref="resultAlert" :variant="resultAlertVariant" :dismissible="resultAlertDismissable || (ifDismissibleDanger && resultAlertVariant == \'danger\')" v-show="resultAlert" ><span v-html="resultAlertMsg"></span> </alert> <v-modal id="mStatusResult" ref="mStatusResult" size="s" :centered="true" hide-footer :title="modalTitle" :variant="modalVariant"><p v-if="modalDescription != \'\'" v-html="modalDescription"></p><div class="mt-3 d-flex justify-content-center"><b-button v-on:click="$bvModal.hide(\'mStatusResult\')" type="button" class="buttonTx buttonBtaTxContinue ui-button-next3" :class="bankId != \'BPOP\' && !modalUiButtonNextExclusion.includes(menuId) ? \'ui-button-next\' : \'\'"  :variant="bankId != \'BPOP\'?\'success\':\'\'" size="s"><icon v-show="bankVerifyIcon()" class="ui-flowbutton-icon iconInternas" :style="bankVerifyIcon() && bankId==\'BPOP\'?\'padding: 3px 16px 0px 16px;\':\'\'"></icon>Continuar</b-button></div></v-modal></div>',props:{flowId:{type:String,required:true,},resultState:{type:Object,required:true,},flagsConfig:{type:Object,"default":function(){return{}},},autoFlags:{type:Object,"default":function(){return{}},},msgConfig:{type:Object,},"if-dismissible-danger":{type:Boolean,"default":false,},service:{type:String,"default":"service"},useCustomHandler:{type:Boolean,},"use-component-error":{type:Boolean,"default":true,}},data:function(){return{resultAlert:"",resultAlertVariant:"",resultAlertDismissable:"",resultAlertMsg:"",modalTitle:"",modalDescription:"",modalVariant:"",modalUiButtonNextExclusion:["4030302","2100102","40102031"],}},computed:{},watch:{},created:function(){setTimeout(function(){refStatusHandler=this}.bind(this),100)},mounted:function(){},methods:{notShowStatusHandler:function(){this.resultAlert=false},showResult:function(r,c){var b=/^0*$/;var j="";var p="";if(this.msgConfig!=undefined&&this.msgConfig.length==0&&JSON.stringify(this.autoFlags)==="{}"){this.$emit("default-handler",this.flowId,r,"after-tokenkey-confirm")}else{if(r.statusTransaction!=undefined&&r.statusTransaction[0]!=undefined&&r.statusTransaction[0].StatusCode!=undefined){j=r.statusTransaction[0].StatusCode}if(typeof r.Status!="undefined"){var i=r.Status;if(Array.isArray(i)){i=i[i.length-1]}if(i!=undefined){j=(typeof i.StatusCodeAlt!="undefined"&&i.StatusCodeAlt.length!=0)?i.StatusCodeAlt:i.StatusCode!="undefined"&&i.StatusCode!="REC"?i.StatusCode:i.StatusCodeError;p=typeof i.StatusDescAlt!="undefined"?i.StatusDescAlt:"";if(r.statusCode=="R"&&r.rejectDetail=="R"){if(typeof logoutWithAllLinks!="undefined"){logoutWithAllLinks()}}}}else{if(typeof r.statusCode!="undefined"&&typeof r.messageError!="undefined"&&!Array.isArray(r.messageError)&&r.messageError!=""){j=r.statusCode;p=r.messageError}else{if(typeof r.StatusCode!="undefined"&&r.StatusCode!="REC"){j=r.StatusCode;p=r.StatusDesc!=undefined?r.StatusDesc:""}else{if(typeof r.StatusCodeError!="undefined"&&r.StatusCodeError.length!=0){j=r.StatusCodeError;p=r.StatusDescAlt!=undefined?r.StatusDescAlt:""}else{if(typeof r.ModuleResponseError!="undefined"){r=r.ModuleResponseError;j=typeof r.statusCode!="undefined"?r.statusCode:"";p=typeof r.messageError!="undefined"?r.messageError:typeof r.StatusDescAlt!="undefined"?r.StatusDescAlt:"";if(j=="9999069"&&p==""){p=this.scheduled()}}else{if(typeof r.StatusCodeAlt!="undefined"){j=r.StatusCodeAlt;p=r.StatusDescAlt!=undefined?r.StatusDescAlt:""}else{if(r.StatusTxCode!=undefined&&r.StatusTxCode=="PRO"){j="9999002"}else{if(r.Envelope&&r.Envelope[0].Status){j=r.Envelope[0].Status[0].StatusCode}else{if(r.Envelope&&r.Envelope[0].XferAddRs&&r.Envelope[0].XferAddRs[0].Status){j=r.Envelope[0].XferAddRs[0].Status[0].StatusCode;p=r.Envelope[0].XferAddRs[0].Status[0].StatusDesc;if(j=="800"||j=="999800"){p="Su Transacci&oacute;n se encuentra en Proceso"}}}}}}}}}}if(j.length==0||j==""||(!b.test(j)&&(j==""||p==""))){var a="/icbs-web/AjaxTx?AID=GENERAL_GET_DATA-0200&RQE=FAC0019C79B63574&CRFT=fac0019c79b6348e";if(a.indexOf("MID=20108")!="-1"){a=a.replace("MID=20108","MID="+menuId)}var h=syncAjaxLoadText({url:a,});if(typeof h.Status!="undefined"){var i=h.Status;var q=false;if(j!==""){var m=i.filter(function(f){return f.StatusCodeAlt===j});if(m!==undefined&&m.length===1){i=m[0];q=true}}if(!q){i=i[i.length-1]}j=typeof i.StatusCodeError!="undefined"&&!Array.isArray(i.StatusCodeError)?i.StatusCodeError:typeof i.StatusCodeAlt!="undefined"?i.StatusCodeAlt:i.StatusCode!="undefined"?i.StatusCode:i.StatusCodeError;p=typeof i.StatusDescAlt!="undefined"?i.StatusDescAlt:""}else{if(typeof h.statusCode!="undefined"&&typeof h.messageError!="undefined"){j=h.statusCode;p=h.messageError}else{if(typeof h.ModuleResponseError!="undefined"){h=h.ModuleResponseError;j=typeof h.statusCode!="undefined"?h.statusCode:"";p=typeof h.messageError!="undefined"?h.messageError:typeof h.StatusDescAlt!="undefined"?h.StatusDescAlt:""}else{if(typeof h.StatusCodeAlt!="undefined"){j=h.StatusCodeAlt;p=h.StatusDescAlt!=undefined?h.StatusDescAlt:""}else{if(typeof h.StatusCode!="undefined"){j=h.StatusCode;p=h.StatusDesc!=undefined?h.StatusDesc:""}}}}}if(j=="0"&&typeof i.StatusCode!="undefined"&&i.StatusCode=="REC"){j+="_error"}}if(j=="300254"){this.cancelVirtualToken("/icbs-web/AjaxTx?AID=CONFIRM_CANCEL_VIRTUAL_TOKEN&RQE=FAC0019C79B63575&CRFT=fac0019c79b6348e")}else{if(j=="300255"){this.cancelVirtualToken("/icbs-web/AjaxTx?AID=LOGIN_CANCEL_VIRTUAL_TOKEN-0001&RQE=FAC0019C79B63576&CRFT=fac0019c79b6348e")}else{if(j=="300172"){p="El usuario fue bloqueado por reintentos de token"}else{if(j=="9999069"){p=this.scheduled()}else{p=this.consultData(p)}}}}if(!this.useCustomHandler&&(b.test(j)||j=="EXI")){this.$emit("default-handler",this.flowId,r,"after-tokenkey-confirm")}else{if(!this.useCustomHandler){var g="danger";if(j=="9999002"||j=="9999069"||j=="800"||j=="999"||j=="900"||j=="999800"||(j=="300"&&i.StatusCode=="EPR")){g="warning"}this.setPrevData(g=="danger",r,j,p);setTimeout(function(){if(typeof checkedUrl!="undefined"){instance.checkServiceActions=new CheckServiceActions(checkedUrl)}},500);if(typeof c!="undefined"&&c){this.$emit("default-handler",this.flowId,r,"after-tokenkey-confirm")}this.showDefaultResult(d,[],j,p,g,g=="danger"?this.isDismissible():false)}else{if(this.$root.$refs.spinnervue){this.$root.$refs.spinnervue.finishSpinnerVue()}else{if(tabComponent!=undefined){tabComponent.$refs.spinnervue.finishSpinnerVue()}}var n=true;var l=this.findCodeFromObject(j);if(l.length>0){l=l[0];n=l.useDefault}else{if(l.length==0){l=this.searchAltConfigs(j);if(l.length>0){l=l[0];n=l.useDefault}}}var d=l.flags!=undefined?l.flags:{};var e=Object.keys(this.flagsConfig);for(var k in e){var o=e[k];if(Object.keys(d).indexOf(o)==-1){d[o]=this.flagsConfig[o]}}this.setFlags(d);this.setPrevData(g=="danger",r,j,p);if(!n){if(l.useModal!=undefined&&l.useModal){this.showResultModal(l.text,l.modalDescription!=undefined?l.modalDescription:"",l.modalVariant!=undefined?l.modalVariant:"success")}if(l.useAlert!=undefined&&l.useAlert){this.showResultAlert(l.text,l.variant,l.isDismissible!=undefined?l.isDismissible:false)}if(l.addBehaviour!=undefined&&typeof l.addBehaviour=="function"&&r!=null&&r!=undefined){l.addBehaviour(r)}if(this.$root.$refs.spinnervue){this.$root.$refs.spinnervue.finishSpinnerVue()}else{if(tabComponent!=undefined){tabComponent.$refs.spinnervue.finishSpinnerVue()}}}else{if(l.isDismissible!=undefined){this.showDefaultResult(d,l,j,p,l.variant,l.isDismissible,r)}else{this.showDefaultResult(d,l,j,p,l.variant,false,r)}}showContent("authorizationLabel","/icbs-web/Ajax?AID=AUTHORIZATIONS_WIDGET&RQE=FAC0019C79B63577&CRFT=fac0019c79b6348e&newRedesign=1");this.$emit("on-show-result",j,r)}}}},consultData:function(c){var a="/icbs-web/AjaxTx?AID=GENERAL_GET_DATA-0500&RQE=FAC0019C79B63578&CRFT=fac0019c79b6348e";if(a.indexOf("MID=20108")!="-1"){a=a.replace("MID=20108","MID="+menuId)}var b=syncAjaxLoadText({url:a,});return typeof b=="string"?b:c},scheduled:function(){if(menuId=="201030204"||menuId=="201030210"){return"Pago programado."}return"Transacci&oacute;n programada."},cancelVirtualToken:function(a){this.finishActionChallengeInterval();syncAjaxLoadText({url:a})},finishActionChallengeInterval:function(){if(vm&&vm.$refs.tokenChallenge){if(vm.$refs.tokenChallenge.completeTimeWorker){vm.$refs.tokenChallenge.completeTimeWorker.postMessage({action:"stop"})}if(vm.$refs.tokenChallenge.timeTryAgainWorker){vm.$refs.tokenChallenge.timeTryAgainWorker.postMessage({action:"stop"})}if(vm.$refs.tokenChallenge.actionChallengeInterval){clearInterval(vm.$refs.tokenChallenge.actionChallengeInterval)}}},isDismissible:function(){if(typeof this.autoFlags.isDismissible!="undefined"){if(this.autoFlags.isDismissible.flowId!=""&&this.autoFlags.isDismissible.flowId.includes("/")){var a=this.autoFlags.isDismissible.flowId.split("/");for(var b in a){if(this.flowId==a[b]){return true}}}else{if(this.flowId==this.autoFlags.isDismissible.flowId){return true}}}return false},setPrevData:function(r,k,c,i){flags={setDisabledPdf:true,setShowResult:true,setFormOriginResult:true,setFormDestinyResult:true,};var o=Object.keys(this.autoFlags);for(var p in o){var m=o[p];var g=typeof this.autoFlags[m].notDanger!="undefined"?this.autoFlags[m].notDanger:false;if(typeof this.autoFlags[m].flowId!="undefined"&&this.autoFlags[m].flowId.includes("/")&&m!="isDismissible"&&m!="refs"&&m!="hideModal"&&m!="methodFlag"&&m!="notShowAlert"){var q=this.autoFlags[m].flowId.split("/");var d=this.autoFlags[m].value.toString().split("/");for(var n in q){if(d[n]=="true"||d[n]=="false"){d[n]=stringToBool(d[n])}this.setData(q[n],d[n],m,g,r)}}else{if(m!="isDismissible"&&m!="refs"&&m!="hideModal"&&m!="methodFlag"&&m!="notShowAlert"){this.setData(this.autoFlags[m].flowId,this.autoFlags[m].value,m,g,r)}else{if(m=="hideModal"){if(typeof this.autoFlags[m].flowId!="undefined"&&this.autoFlags[m].flowId.includes("/")){var q=this.autoFlags[m].flowId.split("/");var b=this.autoFlags[m].idModal.split("/");for(n in q){if(this.flowId==q[n]){this.$bvModal.hide(b[n])}}}else{if(this.flowId==flowId){this.$bvModal.hide(this.autoFlags[m].idModal)}}}}}}if(typeof this.autoFlags.refs!="undefined"){var t=this.autoFlags.refs;var h=Object.keys(t);for(var j in h){var e=h[j];var g=typeof t[e].notDanger!="undefined"?t[e].notDanger:false;if(typeof t[e].flowId!="undefined"&&t[e].flowId.includes("/")){var l=t[e].flowId.split("/");var s=t[e].value.split("/");var a=t[e].reference.split("/");for(var n in l){if(s[n]=="true"||s[n]=="false"){s[n]=stringToBool(s[n])}this.setDataRefs(l[n],s[n],e,g,r,a[n])}}else{this.setDataRefs(t[e].flowId,t[e].value,e,g,r,t[e].reference)}}}if(typeof this.autoFlags.methodFlag!="undefined"){this.autoFlags.methodFlag(this.flowId,k,this.$root,c,i)}setTimeout(function(){if(typeof this.autoFlags.notShowAlert!="undefined"){var u=this.autoFlags.notShowAlert.flowId;if(u.includes("/")){var f=u.split("/");for(n in f){if(this.flowId==f[n]){this.resultAlert=false}}}else{if(this.flowId==u){this.resultAlert=false}}}}.bind(this),200)},setDataRefs:function(c,g,e,d,b,a){var f=this.getVarRefs(a.split("."));if((this.flowId==c||c=="ALL")&&(b||!d)){f[e]=g}else{if((this.flowId==c||c=="ALL")&&(!b&&d)){f[e]=!g}}},getVarRefs:function(a){var b;for(val in a){if(val=="0"){b=this.$root[a[val]]}else{b=b[a[val]]}}return b},setData:function(b,e,d,c,a){if((this.flowId==b||b=="ALL")&&(a||!c)){this.$root[d]=e}else{if((this.flowId==b||b=="ALL")&&(!a&&c)){this.$root[d]=!e}}},showDefaultResult:function(c,f,e,h,d,i,j){var a=/^0*$/;if(a.test(e)){if(c&&c.setDisabledPdf!=undefined&&c.setDisabledPdf){this.$root.disabledPdf=false}if(c&&c.setAdditionalInfo!=undefined&&c.setAdditionalInfo){this.$root.showAdditionalInfo=true;this.$root.txAuthNumber=searchDataFromPath(j,c.txAuthPath);this.$root.txDateEmit=formatDate((parseDate("24/02/2026","dd/mm/yy")),"yy/mm/dd")}this.showResultAlert(f.text,d!=undefined?d:"success",i);this.showResultModal(f.text,f.modalDescription!=undefined?f.modalDescription:"",f.modalVariant!=undefined?f.modalVariant:"success")}else{if(e=="9999002"){this.showResultAlert("(9999002) Transacci&oacute;n pendiente por ser autorizada. ","warning",i);showContent("authorizationLabel","/icbs-web/Ajax?AID=AUTHORIZATIONS_WIDGET&RQE=FAC0019C79B63579&CRFT=fac0019c79b6348e&newRedesign=1")}else{e=e.replace("_error","");if(f.hideCode!=undefined&&f.hideCode){this.showResultAlert(f.overwriteStatusDesc!=undefined&&f.overwriteStatusDesc?f.text:"("+e+") "+h,d!=undefined?d:"danger",i)}else{if(e=="800"||e=="999800"||e=="999"){this.showResultAlert("Su Transacci&oacute;n se encuentra en Proceso","warning",false)}else{var b="";if(e=="9999069"){b=(f.text!=undefined)?f.text:(f.overwriteStatusDesc!=undefined&&f.overwriteStatusDesc)?f.text:h+""}else{b=(f.text!=undefined)?"("+e+") "+f.text:("("+e+") "+f.overwriteStatusDesc!=undefined&&f.overwriteStatusDesc)?f.text:"("+e+") "+h+""}this.showResultAlert(b,d!=undefined?d:"danger",i)}}}}if(f.addBehaviour!=undefined&&typeof f.addBehaviour=="function"&&j!=null&&j!=undefined){f.addBehaviour(j)}if(this.$root.$refs.spinnervue){this.$root.$refs.spinnervue.finishSpinnerVue()}else{if(tabComponent!=undefined){tabComponent.$refs.spinnervue.finishSpinnerVue()}}if(e!="800"&&e!="9999069"){var g=window.location.href;if(g.indexOf("#20201")!=-1&&e!="9999002"){showQualtricsModal("Transacciones - Transferencias - Internas, Aval - Nuevas Transacciones")}else{if(g.indexOf("#20102")!=-1){showQualtricsModal("Transacciones - Pagos - A Terceros - Nuevas Transacciones")}else{if(g.indexOf("#20501")!=-1&&e!="9999002"){showQualtricsModal("Transacciones - Pago Obligaciones - Obligaciones Internas y Aval - Nuevas Transacciones")}}}}},showResultAlert:function(c,a,b){var d=this;setTimeout(function(){d.resultAlert=true;d.resultAlertDismissable=b;d.resultAlertMsg=c;d.resultAlertVariant=a},100)},showResultModal:function(c,b,a){this.modalTitle=c;this.modalDescription=b;this.modalVariant=a;this.$bvModal.show("mStatusResult")},setFlags:function(a){if(a&&a.setShowResult!=undefined&&a.setShowResult){this.$root.showResult=true}if(a&&a.setDisabledPdf!=undefined&&a.setDisabledPdf){this.$root.disabledPdf=true}if(a&&a.setFormOriginResult!=undefined&&a.setFormOriginResult&&this.$root.$refs.formOrigin!=undefined){this.$root.$refs.formOrigin.showResult=true}setTimeout(function(){if(a&&a.setFormDestinyResult!=undefined&&this.$root.$refs.formDestiny!=undefined){this.$root.$refs.formDestiny.showResult=true;this.$root.$refs.formDestiny.disableSearchButton=true}}.bind(this),200)},findCodeFromObject:function(d){var e=[];if(parseInt(d)!=NaN&&d.indexOf("_error")==-1){d=parseInt(d).toString()}for(var g in this.msgConfig){var b=this.msgConfig[g];var a=b.code.split("/");var f=b.flowId.split("/");if(a.indexOf(d)!=-1&&f.indexOf(this.flowId)!=-1){e.push(b);break}}return e},searchAltConfigs:function(a){var b=[];var c=findObjects(this.msgConfig,"code","default");c=c.filter(function(d){return d.flowId==this.flowId}.bind(this));if(c.length>0){b=c}return b},},});