!function(o){o.widget("ui.modalbox",{version:"4.0.0",options:{modalClass:"ui-modalbox-layout",modalWindowClass:"ui-modalbox-window",overlayClass:"ui-modalbox-overlay",titleDisplay:!1,title:"",imageViewerClass:"ui-modalbox-imageviewer",source:null,type:"html",classTrigger:"ui-modalbox-open",clickOut:!1,closeCaption:"Cerrar",modalFixed:!1,showCloseButton:!0,opacity:.5,focus:!0},requestIndex:0,beforeShow:null,_isValidResponse:function(e){try{var t=o.parseXML(e),n=o(t),i=n.find("StatusCode");if("1401"==i.text())return o(window.location).attr("href","?AID=TIMEOUT"),!1}catch(a){}return!0},_create:function(){this._setDefaults(o.ui.modalbox.getDefaults())},_setDefaults:function(e){var t=this;this.defaults=e,e&&o.each(this.defaults,function(o,e){t.options[o]=e})},_init:function(){var e=this,t=e.options,n=e.element,i=t.idModal?t.idModal:"modal"+n.attr("id");if(this.modal=o("<div id='"+i+"' class='ui-excelsys-widget "+t.modalClass+"'></div>"),this.overlay=o('<div class="ui-modalbox-overlay"></div>'),this.overlay.appendTo(this.modal),this.modalWindow=o("<div></div>"),this.modalWindow.addClass(t.modalWindowClass),this.headerMainWrap=o('<div class="ui-modalbox-header ui-excelsys-clearfix" tabindex="-1"></div>'),t.titleDisplay&&(this.headerTitle=o('<h1 class="ui-modalbox-title">'+t.title+"</h1>").appendTo(this.headerMainWrap)),t.showCloseButton&&(this.closeButton=o('<a href="javascript:void(0);" class="ui-modalbox-close"><span class="ui-modalbox-close-img"></span><span class="ui-modalbox-close-text">'+t.closeCaption+"</span></a>"),this.closeButton.appendTo(this.headerMainWrap)),this.headerMainWrap.appendTo(this.modalWindow),this.modalContent=o('<div class="ui-modalbox-content"></div>'),t.source){if(e.returnSource=!1,"string"==typeof t.source)if("img"==t.type)e.beforeShow=function(){e.modalContent.empty();var n=o("<div class='"+a+"'></div>");e.imageViewer=o("<img class='"+t.imageViewerClass+"' src='"+t.source+"'/>").appendTo(n),e.modalContent.append(n),e.modalContent.appendTo(e.modalWindow),e.modalWindow.appendTo(e.modal)};else if("selector"==t.type){o(t.source).hide();var a=o(t.source).attr("class");e.beforeShow=function(){var n=o(t.source).children("*"),i=o("<div class='"+a+"'></div>");n.detach(),i.append(n),e.modalContent.append(i),e.modalContent.appendTo(e.modalWindow),e.modalWindow.appendTo(e.modal)}}else if("url"==t.type){var s=t.source;this.xhr=o.ajax({url:s,type:"POST",dataType:"html",async:!1,autocompleteRequest:++e.requestIndex,success:function(t,n){return!!e._isValidResponse(t)&&void(this.autocompleteRequest===e.requestIndex&&(e.beforeShow=function(){e.modalContent.empty();var n=o("<div class='ui-modalbox-ajax-response'></div>").append(t);e.modalContent.appendTo(e.modalWindow),e.modalWindow.appendTo(e.modal),e.modalContent.append(n)}))},error:function(t,n,i){this.autocompleteRequest===e.requestIndex&&(e.beforeShow=function(){e.modalContent.empty();var t=o("<div class='ui-modalbox-ajax-response'></div>").append(i);e.modalContent.append(t),e.modalContent.appendTo(e.modalWindow),e.modalWindow.appendTo(e.modal)})}})}else{o(t.source).hide();var a=o(t.source).attr("class");e.beforeShow=function(){var n=o(t.source).children("*").detach();e.modalContent.empty();var i=o("<div class='"+a+"'></div>").append(n);e.modalContent.append(i),e.modalContent.appendTo(e.modalWindow),e.modalWindow.appendTo(e.modal)}}else{t.source.hide();var a=t.source.attr("class");e.beforeShow=function(){var n=t.source.children("*").detach();e.modalContent.empty();var i=o("<div class='"+a+"'></div>").append(n);e.modalContent.append(i),e.modalContent.appendTo(e.modalWindow),e.modalWindow.appendTo(e.modal)}}e._click()}else{n.hide();var d=n.children("*"),a=n.attr("class"),l=e.element.attr("id");e.beforeShow=function(){d.detach();var t=o("<div class='"+a+"'></div>").append(d);e.modalContent.append(t),e.modalContent.appendTo(e.modalWindow),e.modalWindow.appendTo(e.modal)},o(document.body).off("click",'a[href="#'+l+'"], button[modal="#'+l+'"]').on("click",'a[href="#'+l+'"], button[modal="#'+l+'"]',function(o){o.preventDefault(),e.show()})}t.showCloseButton&&this.modalWindow.off("click",".ui-modalbox-close").on("click",".ui-modalbox-close",function(o){o.preventDefault(),e.close()}),this.modal.off("click",".ui-modalbox-close-trigger").on("click",".ui-modalbox-close-trigger",function(e){var t=o(this).data("modalbox");e.preventDefault(),t.close()}),t.clickOut===!0&&this.overlay.on("click",function(o){o.preventDefault(),e.close()}),o("body").append(e.modal)},_click:function(){var e=this;e.options.dynamic||o(e.element).on("click",function(o){e.show()})},close:function(){var o=this;o.offEvents(),o.overlay.fadeOut(),o.modalWindow.fadeOut(),clearTimeout(this.closeElements),this.closeElements=setTimeout(function(){o.modal.hide(),o.returnElements(),o.element.trigger("onClose")},300)},show:function(){var o=this;"function"==typeof this.beforeShow&&this.beforeShow(),clearTimeout(this.closeElements),this.showElements=setTimeout(function(){var e=o.options,t=o.modal,n=o.overlay,i=o.modalWindow;t.add(i).show(),i.hide(),n.css("opacity",e.opacity).fadeIn(),o._center(),i.fadeIn(function(){o.modalContent.show(),o._center()}),o.element.trigger("onShow"),o.onEvents(),o.options.focus&&o.focus()},300)},returnElements:function(){var e=this,t=e.options,n=e.element,i={};t.source?"string"==typeof t.source?"selector"==t.type?(i=e.modalContent.children("div").children("*").detach(),o(t.source).append(i)):e.modalContent.empty():(i=e.modalContent.children("div").children("*").detach(),o(t.source).append(i)):(i=e.modalContent.children("div").children("*").detach(),o(n).append(i))},_center:function(){this.modalWindow.css("position","absolute"),this.modalWindow.css("top",(o(window).height()-this.modalWindow.outerHeight())/2+o(window).scrollTop()+"px"),this.modalWindow.css("left",(o(window).width()-this.modalWindow.outerWidth())/2+o(window).scrollLeft()+"px")},focus:function(e){var t=this,n=e&&o.inArray(e,["first","last"])!==-1?e:"first",i=o(":input:enabled:visible:"+n,t.modal);setTimeout(function(){i.length>0?i.trigger("focus"):t.modalContent.trigger("focus")},10)},onEvents:function(){var e=this;o(document).on("keydown",".ui-modalbox",function(o){9===o.keyCode&&e.watchTab(o)})},offEvents:function(){o(document).off("keydown",".ui-modalbox")},watchTab:function(e){var t=this;if(o(e.target).parents(".ui-excelsys-widget").length>0){if(t.inputs=o(":input:enabled:visible:first, :input:enabled:visible:last",t.modalContent),!e.shiftKey&&e.target===t.inputs[t.inputs.length-1]||e.shiftKey&&e.target===t.inputs[0]||0===t.inputs.length){e.preventDefault();var n=e.shiftKey?"last":"first";t.focus(n)}}else e.preventDefault(),t.focus()},destroy:function(){this.overlay.remove();var e=this.element.attr("id");this.offEvents(),o(document.body).off("click",'a[href="#'+e+'"], button[modal="#'+e+'"]'),this.modalWindow.off("click",".ui-modalbox-close"),this.modal.off("click",".ui-modalbox-close-trigger"),clearTimeout(this.closeElements),this.options.dynamic||o(this.element).off("click"),this.modalContent.remove(),this.modalWindow.remove(),o("body").find("#"+this.modal.attr("id")).remove(),o.Widget.prototype.destroy.call(this)}}),o.extend(o.ui.modalbox,{getVersion:function(){return this.version},setDefaults:function(o){this.defaults=o},getDefaults:function(){return this.defaults}})}(jQuery);