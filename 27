!function($){$.widget("ui.combobox",{version:"4.1.1",options:{delay:300,disabled:!1,hoverClass:"ui-state-hover",comboListClass:"ui-combobox",menuClass:"ui-combobox-ul",itemClass:"ui-combobox-li",inputClass:"ui-combobox-input alphanum",buttonClass:"ui-combobox-button",valueIsNumber:!1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,filterOnServer:!1,showButton:!0,promptRegular:null,promptAutocomplete:null,maxlength:null},requestIndex:0,value:null,opendialog:!1,_init:function(){var e=this.options;this.hoverClass=e.hoverClass,this._initSourceInProgress=!1,this.cache=null,this.typing=!1,this._initSource(),this.setDisabled(e.disabled),e.selected?this.setSelected(e.selected):(this._showPrompt(),this.onSelected=!0),e.relatedTo&&this._bindRelatedChangeHandler()},_bindRelatedChangeHandler:function(){var e=this;setTimeout(function(){$(e.options.relatedTo).on("onChange",function(t,o){var s=e.element.data("combobox");s&&s._restart()})},200)},_showPrompt:function(){var e=this.options;this.element.attr("readonly")?this.element.val(e.promptRegular||$.ui.combobox.promptRegular):this.element.val(e.promptAutocomplete||$.ui.combobox.promptAutocomplete)},_create:function(){var e=this,t=this.options;this.hidden=$(t.returnValueTo),this.element.addClass(t.inputClass),this.element.data("combobox",this),this.combobox=$("<ul id='ul"+$(this.element).attr("name")+"' class='"+t.menuClass+"'></ul>"),this.options.menuClasses&&this.combobox.addClass(this.options.menuClasses),this.combobox.addClass(t.comboListClass),t.maxHeight&&this.combobox.css("max-height",t.maxHeight),this.combobox.css({"overflow-y":"auto","overflow-x":"hidden"}),this.combobox.addClass("combobox"),$(this.combobox).css("z-index",parseInt($(this.element).css("z-index"))+100).css({top:0,left:0}),this.combobox.hide(),this.combobox.data("combo",e),this.hasScroll=function(){return this.combobox.height()<this.combobox.attr("scrollHeight")},t.findIn||(t.findIn=t.template),this.element.attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}),this.onchange=null,$("*",document.body).on("click",function(t){var o=$(t.target);if(!$.contains(e.combobox[0],o[0])&&o!==e.button)return e.isOpen()?(clearTimeout(e.closing),e.closing=setTimeout(function(){e.close()},100),!1):void 0}),this.element.on("click",function(){$(e.element).attr("readonly")||(e._clear(),e.validItemSelected=!1)}),this.element.on("blur",function(t){t.preventDefault(),t.stopPropagation();var o=$(this);e=o.data("combobox");var s=$(t.target);if(e.validItemSelected||e._showPrompt(),!$.contains(e.combobox,s)){e.onchange&&clearTimeout(e.onchange),clearTimeout(e.searching);var i=100;navigator.userAgent.match(/Trident\/7\./)&&(i=18e4),e.closing=setTimeout(function(){e.close()},i)}}),$(e.combobox).on("mouseenter mouseleave","li."+t.itemClass,function(t){var o=$(this);return e=o.data("combobox"),e.combobox.children("li").removeClass(e.hoverClass),$(this).addClass(e.hoverClass),!1}),$(e.combobox).on("mousedown","li."+t.itemClass,function(t){var o=$(this);return e=o.data("combobox"),e.selecting(o),!1}),this._restart=function(){this.combobox.empty(),this._initSourceInProgress=!1,this.cache=null,this.source=null,this._initSource(),this.value=null,this._clear(),this.typing=!1,this.term="",this.defaultItem?(this.selecting(this.defaultItem),this.defaultItem=null):(this._showPrompt(),this.element.trigger("onChange",null,""),this.hidden.trigger("onChange",null,""))},this.element.on("keydown",function(t){var o=$(this);e=o.data("combobox");var s=e.options.maxlength?e.options.maxlength:39;if(!o.attr("readonly")&&o.val().length>=s)return t.preventDefault(),!1;if(38!==t.keyCode&&40!==t.keyCode||t.preventDefault(),/MSIE ([0-9]+)\./.test(window.navigator.userAgent)&&8===t.keyCode&&e.element.attr("readonly"))return window.event.keyCode=0,!1;if(!e.disabled)if($.ui.combobox._isSilentKeyCode(t.keyCode))e.isOpen()?e._handleExpandedListKey(t):e._handleCollapsedListKey(t);else{if(e.element.attr("readonly"))return void t.preventDefault();e.typing||e._clear(),e.typing=!0,e.validItemSelected=!1,e.searching=setTimeout(function(){e.term!==e.element.val()&&(e.search(null,t),e.open())},e.options.delay)}}),this.onselect=null,this.selecting=function(o){try{var s,i,i,s,s,i,i,s,n=o.data("item.combobox"),n=o.data("item.combobox");n?(i=n[e.options.keyField],s=unscapeSpecialCharacters(o.data("item.combobox.findIn"))):(i="-1",s=e.element.attr("readonly")?t.promptRegular?t.promptRegular:$.ui.combobox.promptRegular:t.promptAutocomplete?t.promptAutocomplete:$.ui.combobox.promptAutocomplete),e.typing=!1,e.element.val(s),e.validItemSelected=!0,e.value=i,e.options.selected=null,e.hidden.val(i),e.onselect&&clearTimeout(e.onselect),e.onselect=setTimeout(function(){e.element.trigger("onSelect",null,i)},150),$.when(e.close()).then(function(){e.element.trigger("onChange",null,i),e.hidden.trigger("onChange",null,i)})}catch(r){return!1}},this.response=function(){return e._response.apply(e,arguments)},this.button=$("<button type='button'>&nbsp;</button>"),this.button.attr("tabIndex",-1),this.button.insertAfter(this.element),this.button.addClass(t.buttonClass),this.button.data("combobox",e),t.showButton||this.button.hide(),this.button.on("click",function(t){t.preventDefault();var o=$(this);return e=o.data("combobox"),!e.disabled&&(e.isOpen()?e.close():($.each($("."+e.options.menuClass),function(){$(this).data("combo")!==e&&$(this).data("combo").close()}),e.search("",t),e.open()),!1)}),this._adjustWidth(),e.combobox.insertAfter(this.button)},_handleCollapsedListKey:function(e){var t=$.ui.keyCode;switch(e.keyCode){case t.DOWN:this.element.attr("readonly")||(this._clear(),this.typing=!0,this.validItemSelected=!1),this._move("next",e)}},_handleExpandedListKey:function(e){var t=$.ui.keyCode;switch(e.keyCode){case t.UP:this._move("previous",e);break;case t.DOWN:this._move("next",e);break;case t.HOME:this._move("first",e);break;case t.END:this._move("last",e);break;case t.ENTER:case t.NUMPAD_ENTER:var o=this.combobox.children("li."+this.hoverClass);this.selecting(o);break;case t.TAB:var o=this.combobox.children("li."+this.hoverClass);this.selecting(o);break;case t.ESCAPE:this.close(),this.element.attr("readonly")||(this.value=null,this._clear(),this.onchange&&clearTimeout(this.onchange),""!==this.element.val()&&(this.onchange=setTimeout(function(){this.element.trigger("onChange",e,""),this.hidden.trigger("onChange",e,"")},150)))}},_adjustWidth:function(){var e=this.options;if(e.width)this.combobox.css("width",e.width);else if(e.showButton){var t=$(this.button).offset(),o=$(this.element).offset();left=t.left-(o.left+this.element.outerWidth());var s=((this.button.outerWidth()-this.button.width())/2+this.button.width(),(this.element.outerWidth()-this.element.width())/2+this.element.width()),i=t.left+this.button.outerWidth();s=i-o.left,this.combobox.width(s)}else{var s=(this.element.outerWidth()-this.element.width())/2+this.element.width();this.combobox.width(s)}},setSelected:function(e){var t=this;if(e)var o=setInterval(function(){t.onSelected=!0,t._search(""),t.cache?(t.options.relatedTo&&(t._initSourceInProgress||t._initSource()),t._findSelected(t.cache,e),clearInterval(o)):t._initSourceInProgress||t._initSource()},10)},_findSelected:function(e,t){var o=this.options;if(null==e)return!1;var s=o.valueIsNumber&&parseInt(t,10),i=$.grep(e,function(e,i){return!!e&&(e[o.keyField]===t||o.valueIsNumber&&!isNaN(s)&&parseInt(e[o.keyField],10)===s)});if(i[0]&&("undefined"==typeof this.term||this.term.length<1)){var n=this._prepareItem(i[0]);this.selecting(n)}},_prepareItem:function(e){var t=this,o=this.options,s=null;return"object"!=typeof e&&""===o.template&&(s=$("<li class='"+o.itemClass+"'>"+e+"</li>")),"object"!=typeof e&&""!==o.template&&(s=$("<li class='"+o.itemClass+"'>"+$.ui.combobox.bindDataToTemplate(e,o.template)+"</li>")),"object"==typeof e&&""===o.template&&""!==o.displayPropertyName&&(s=$("<li class='"+o.itemClass+"'>"+e[o.displayPropertyName]+"</li>")),"object"==typeof e&&""!==o.template&&(s=$("<li class='"+o.itemClass+"'>"+$.ui.combobox.bindDataToTemplate(e,o.template)+"</li>")),null!==s&&(s.data("item.combobox",e),s.data("item.combobox.findIn",$.ui.combobox.bindDataToTemplate(e,o.findIn)),s.data("combobox",t)),s},_renderMenu:function(e,t){var o=this;$.each(t,function(t,s){return"object"==typeof s&&"iefix"===s.dummy||void("object"==typeof s&&(s.name&&null!=o.options.maxlength&&s.name.length>parseInt(o.options.maxlength)&&(s.name=s.name.substr(0,o.options.maxlength)),o._renderItem(e,s)))})},_renderItem:function(e,t){var o=this,s=o.options,i=null,n=t[s.keyField]===-1,r=o.element.parents(".input-required").length>0;r=r||this.element.hasClass("required"),r&&n||(i=this._prepareItem(t),s.itemClasses&&i.addClass(s.itemClasses),i.appendTo(e))},_isValidResponse:function(e){try{var t=$.parseXML(e),o=$(t),s=o.find("StatusCode");if("1401"===s.text())return $(window.location).attr("href","?AID=TIMEOUT"),!1}catch(i){}return!0},_filterRelated:function(e,t){var o=$(this.options.relatedTo).attr("id");this.cache=$.grep(e,function(e,s){var i=e[o];return!(!i||e.isdeleted)&&(i===t||Array.isArray(i)&&$.inArray(t,i)>=0)}),$.isEmptyObject(this.cache)?this.cache=[]:this._findSelected(this.cache,-1)},_filterDeleted:function(e){this.cache=$.grep(e,function(e,t){return!e.isdeleted}),$.isEmptyObject(this.cache)?this.cache=[]:this._findSelected(this.cache,-1)},_clear:function(){this.element.val(""),this.hidden.val("")},_initSourceInProgress:!1,_initSource:function(){var value=null;if(!this.options.relatedTo||(value=$(this.options.relatedTo).val(),value=value?value:"-1",value=0===value.indexOf("[")&&value.indexOf("]")===value.length-1?eval(value)[0]:value,""!==value)){var self=this,array,url;self._initSourceInProgress=!0,Array.isArray(this.options.source)?(array=this.options.source,this.options.relatedTo?this.source=function(e,t){self._filterRelated(array,value),t($.ui.combobox.filter(self.cache,e.term,self.options.findIn,self))}:(self.cache=array,this.source=function(e,t){self._filterDeleted(array),t($.ui.combobox.filter(self.cache,e.term,self.options.findIn,self))})):"object"==typeof this.options.source?this.options.source&&(array=this.options.source.list,this.options.relatedTo?(self._filterRelated(array,value),response($.ui.combobox.filter(self.cache,request.term,self.options.findIn,self))):(self.cache=array,this.source=function(e,t){t($.ui.combobox.filter(self.cache,e.term,self.options.findIn,self))})):"string"==typeof this.options.source&&(url=this.options.source,this.source=function(e,t){self.cache?(self._initSourceInProgress=!1,t($.ui.combobox.filter(self.cache,e.term,this.options.findIn,self))):(self.xhr&&self.xhr.abort(),self.xhr=$.ajax({url:url,type:"POST",data:e,dataType:"text",async:!1,autocompleteRequest:++self.requestIndex}).done(function(o,s,i){if(!self._isValidResponse(o))return!1;if(this.autocompleteRequest===self.requestIndex&&o)if(self.cache=o,self.options.relatedTo&&!self.options.filterOnServer){var n=$(self.options.relatedTo).attr("id");self.cache=$.grep(self.cache,function(e,t){var o=e[n];return!!o&&o===value}),self._initSourceInProgress=!1,t(self.cache)}else self._initSourceInProgress=!1,t($.ui.combobox.filter(self.cache,e.term,self.options.findIn,self))}).fail(function(e,o,s){self.cache=[],self._initSourceInProgress=!1,this.autocompleteRequest===self.requestIndex&&t(self.cache)}))}),self.cache&&(self._initSourceInProgress=!1)}},_suggest:function(e){$(this.combobox).css("z-index",parseInt($(this.element).css("z-index"))+100);var t=this.combobox;this.combobox.empty(),this._renderMenu(t,e),this.onSelected||this.isOpen()||(this.open(),this.element.trigger("focus")),this.onSelected&&(this.onSelected=!1)},_search:function(e){var t=this;this.pending++,this.element.addClass("combobox-loading");var o={term:e};if(this.options.extraAjaxQuery&&(o=$.extend(this.options.extraAjaxQuery,o)),this.options.relatedTo){var e=$(this.options.relatedTo).val(),s=$(this.options.relatedTo).attr("id");if(e){var i='{"'+s+'":"'+e+'"}';o=$.extend({},o,JSON.parse(i))}}null!=t.source&&t.source(o,t.response)},_response:function(e){this._suggest(e),this.pending--,this.pending||this.element.removeClass("combobox-loading")},_move:function(e,t){if(!this.isOpen())return void this.search(null,t);this[e](t);var o=this.combobox.find("."+this.hoverClass);if(this.hasScroll()&&o&&o.offset()&&o.offset().top&&this.combobox.offset()&&this.combobox.offset().top){var s=o.offset().top-this.combobox.offset().top,i=this.combobox.attr("scrollTop"),n=this.combobox.height();s<0?this.combobox.attr("scrollTop",i+s):s>=n&&this.combobox.attr("scrollTop",i+s-n+o.height())}t.preventDefault()},next:function(e){if(this.combobox.children("li").last().hasClass(this.hoverClass))return void this.first(e);if(0!==this.combobox.has("."+this.hoverClass).length){var t=this.combobox.children("li."+this.hoverClass);t.removeClass(this.hoverClass),t.next().addClass(this.hoverClass)}else this.combobox.children("li").removeClass(this.hoverClass),this.combobox.children("li").first().addClass(this.hoverClass)},previous:function(e){if(this.combobox.children("li").first().hasClass(this.hoverClass))return void this.last(e);if(0!==this.combobox.has("."+this.hoverClass).length){var t=this.combobox.children("li."+this.hoverClass);t.removeClass(this.hoverClass),t.prev().addClass(this.hoverClass)}else this.combobox.children("li").removeClass(this.hoverClass),this.combobox.children("li").last().addClass(this.hoverClass)},first:function(){if(0!==this.combobox.has("."+this.hoverClass).length){var e=this.combobox.children("li."+this.hoverClass);e.removeClass(this.hoverClass)}this.combobox.children("li").first().addClass(this.hoverClass)},last:function(){if(0!==this.combobox.has("."+this.hoverClass).length){var e=this.combobox.children("li."+this.hoverClass);e.removeClass(this.hoverClass)}this.combobox.children("li").last().addClass(this.hoverClass)},isOpen:function(){return this.opendialog},open:function(){clearTimeout(this.closing),this.isOpen()||this.combobox.slideDown(["fast"]),this.combobox.position($.extend({of:this.element},this.options.position)),this._adjustWidth(),this.opendialog=!0,this.element.trigger("focus")},close:function(){clearTimeout(this.closing),this.isOpen()&&this.combobox.slideUp(["fast"]),this.opendialog=!1},cancel:function(){var e=this,t=e.combobox.children("li."+e.hoverClass);return(0===t.length||""===e.element.val())&&(clearTimeout(e.searching),e.closing=setTimeout(function(){e.close()},100),!0)},selected:function(){return this.value},getOptions:function(){return this.options},search:function(e,t){return null==this.source?void(this._initSourceInProgress||this._initSource()):(this.term=null!=e?e:this.element.val(),this.element.attr("readonly")&&(this.term=""),this.options.minLength&&this.term.length<this.options.minLength?this.close():(clearTimeout(this.closing),this._trigger("search",t)!==!1?(this._search(this.term),this.term=""):void 0))},setDisabled:function(e){this.disabled=e,e?(this.element.attr("disabled","disabled"),this.element.addClass("disabled ui-combobox-disabled ui-state-disabled")):(this.element.prop("disabled",!1),this.element.removeClass("disabled ui-combobox-disabled ui-state-disabled"))},setPromptAutocomplete:function(e){this.options.promptAutocomplete=e,this._showPrompt()},setPromptRegular:function(e){this.options.promptRegular=e,this._showPrompt()},firstList:function(){var e=this.combobox.children("li").first(),t=e.data("item.combobox");return{name:e.data("item.combobox.findIn"),val:t[this.options.keyField]}},firstListRelated:function(){var e=this.options,t=this.options.source;if(t)return t[0][e.keyField]},findObjSource:function(e,t){var o=this.options,s={},i=t||o.keyField,n={},r=[],l=0,a=[];if(e&&$.isPlainObject(e)&&!$.isEmptyObject(e)){for(n in e){if(3===l)break;e.hasOwnProperty(n)&&(r[l]=n.toString(),a[l]=e[n],l++)}switch(r.length){case 1:s=$.grep(o.source,function(e,t){return e[r[0]]===a[0]});break;case 2:s=$.grep(o.source,function(e,t){return e[r[0]]===a[0]&&e[r[1]]===a[1]});break;case 3:s=$.grep(o.source,function(e,t){return e[r[0]]===a[0]&&e[r[1]]===a[1]&&e[r[2]]===a[2]})}}else e&&e.length>0&&(s=$.grep(o.source,function(t,o){return t[i]===e}));return s},refresh:function(){this.combobox.empty(),this._initSourceInProgress=!1,this.cache=null,this.source=null,this._initSource(),this.value=null,this._clear(),this.typing=!1,this.term="",this.defaultItem?this.selecting(this.defaultItem):(this._showPrompt(),this.element.trigger("onChange",null,""),this.hidden.trigger("onChange",null,""))},reset:function(){this.combobox.empty(),this._initSourceInProgress=!1,this.cache=null,this.source=null,this._initSource(),this.value=null,this._clear(),this.typing=!1,this.term="",this._showPrompt(),this.element.trigger("onChange",null,""),this.hidden.trigger("onChange",null,"")},removeItem:function(e){var t=this,o=t.cache,s=t.options.keyField;if(Array.isArray(t.options.source)){var i=t.options.source;$.grep(i,function(o,i){return o[s]===e&&(t.options.source[i].isdeleted=!0),o[s]===e})}Array.isArray(o)&&(this.cache=$.map(o,function(t,o){return t[s]!==e?t:void 0})),t.refresh()},addItem:function(e,t){var o=this,s=o.options.source;if(Array.isArray(s)){var i=-1,n=o.options.keyField,r=void 0!==t?void 0:e;if(r){$.grep(s,function(e,t){return e[n]===r&&(i=t,o.options.source[t].isdeleted=!1),e[n]===r})}else e.isdeleted=!1,o.options.source=t?o.options.source.push(e):o.options.source.unshift(e)}else t=!t||t,e.isdeleted=!1,o.cache=t?o.cache.push(e):o.cache.unshift(e);o.refresh()},setSource:function(e,t){t=!!t&&t,Array.isArray(this.options.source)?this.options.source=t?this.options.source.concat(e):this.options.source=e:this.cache=t?this.cache.push(obj):this.cache=e,this.refresh()},getSource:function(){return this.options.source}}),$.extend($.ui.combobox,{getVersion:function(){return this.version},promptAutocomplete:" Digite o seleccione",promptRegular:"Seleccione",escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},bindDataToTemplate:function(e,t){return""===e?this:t.replace(/\[([^\[\]]*)\]/g,function(t,o){return"object"==typeof e?e[o]:e})},filter:function(e,t,o,s){var i=new RegExp($.ui.combobox.escapeRegex(t),"i"),n=!1,r=$.grep(e,function(e){templateValue=$.ui.combobox.bindDataToTemplate(e,o);var t=i.test(templateValue);return t&&(n=!0),t});return n||s.close(),r},silentKeys:["CAPS_LOCK","COMMAND","COMMAND_LEFT","COMMAND_RIGHT","CONTROL","DELETE","DOWN","END","ENTER","ESCAPE","HOME","INSERT","MENU","PAGE_DOWN","PAGE_UP","RIGHT","SHIFT","TAB","UP","WINDOWS"],_isSilentKeyCode:function(e){for(var t,o=0;o<$.ui.combobox.silentKeys.length;++o)if(t=$.ui.combobox.silentKeys[o],$.ui.keyCode[t]===e)return!0;return!1}})}(jQuery);