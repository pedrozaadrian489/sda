Vue.component("token-challenge",{template:'<div :class="{\'margin-challenge\':initialParent == \'login\'}"><spinner-vue ref="spinnerChallenge"></spinner-vue><div class="d-flex mb-4 w-ellipse-progress" :class="isContingency?\'size-content-new-try-qr pb-3\':\'\'" style="width: 446px;" :style="isContingency ? initialParent == \'service\' && !isUx ? { borderBottom: \'1px solid #E6E6E6\', width: \'930px !important\' } : { borderBottom: \'1px solid #E6E6E6\' } : {}"><vue-ellipse-progress v-if="!isContingency || (isContingency && step==\'1\')":progress="tasksDonePercent"color="#008B00"emptyColor="#CAEFCA":legend="false":thickness="4":no-data="noData":empty-thickness="4":size="sizeEllipse"></vue-ellipse-progress><span class="mt-1 text-left text-size-virtual" :class="!isContingency || (isContingency && step==\'1\') ? \'margin-left-title-virtual\' : \'\'" v-html="msgEllipseProgress"/></div><div v-if="step==\'1\'" :class="timeNewTry?\'sbl-h-1\':\'sbl-h-2\'"><div class="container-try-again size-content-new-try-push" v-if="timeNewTry"><div v-html="msgTryAgain" class="msg-try-again text-left"></div><b-progress class="mt-2 prog-try-again size-prog-try-again-push" :max="max"><b-progress-bar :value="timeTryAgain" variant="warning"></b-progress-bar></b-progress></div><div v-else class="new-try-st container-try-again size-content-new-try-push text-left"><span v-html="\'Enviamos una notificaci&oacute;n a tu celular, si no la recibes \'"></span><a id="newTry" v-if="showNewTry" @click="newTry" class="link-challenge" v-html="\'Intenta de nuevo \'"></a><span v-html="\'o puedes intentar con \'"></span><a id="codeQr" @click="nextStep" class="link-challenge" v-html="\'C&oacute;digo QR\'"></a></div></div><div :class="isContingency && initialParent == \'service\' && !isUx ? \'d-flex\' : \'\'" :style="isContingency && initialParent == \'service\' && !isUx ? { alignItems: \'center\' } : {}"><div v-if="(step==\'2\' || (step==\'3\' && isContingency)) && !isBlocked" :class="!isContingency ? timeNewTry?\'sbl-h-3\':\'sbl-h-4\' : \'\'"><div class="container-try-again size-content-new-try-qr" :class="isContingency ? \'d-flex flex-row\' : \'\'" :style="isContingency && initialParent == \'service\' ? { background: \'transparent\' } : {}"><div v-if="isContingency"><ol style="padding-left: 16px; text-align: left;"><li class="mb-4"><span>Abre e inicia sesi&oacute;n en la <strong>App Banca M&oacute;vil Empresas.</strong></span></li><li><span>Con tu celular, <strong>escanea el c&oacute;digo QR</strong> y sigue las instrucciones.</span></li></ol></div><div><div class="text-center"><img class="w-img-qr":src="\'data:image/jpeg;base64,\'+imgCodeQr"/></div><div v-if="timeNewTry && !isContingency" class="mt-3"><div v-html="msgTryAgain" class="msg-try-again text-left"></div><b-progress class="mt-2 prog-try-again" :max="max" :style="isContingency && initialParent == \'service\' && !isUx ? { width: \'382px !important\' } : {}"><b-progress-bar :value="timeTryAgain" variant="warning"></b-progress-bar></b-progress></div><div v-else class="new-try-st text-center mt-3"><a id="newTry" v-if="showNewTry" @click="newTry" class="link-challenge" :class="isContingency && isTimeComplete ? \'disabledButtonAction\' : \'\'" v-html="!isContingency ? \'Actualizar\' : \'Actualizar C&oacute;digo\'"></a><span v-if="showNewTry && !isContingency" v-html="\'o \'"></span><span v-if="!isContingency" v-html="showNewTry?\'ingresar con \':upperFirstChar(\'ingresar con \')"></span><a v-if="!isContingency" id="codeSoft" @click="nextStep" class="link-challenge" v-html="\'C&oacute;digo de verificaci&oacute;n\'"></a></div></div></div></div><div v-if="((step==\'2\' && isContingency) || step==\'3\') && (isTimeComplete==false || isContingency)"><div class="container-try-again size-content-new-try-soft" :style="isContingency && initialParent == \'service\' ? { background: \'transparent\', display: \'flex\' } : {}"><span v-if="!isContingency" class="sub-title-code-verify text-left d-flex margin-left-text-soft">Ingresa tu c&oacute;digo de verificaci&oacute;n</span><div v-if="isContingency"><ol style="padding-left: 16px; text-align: left;" start="3"><li><span><strong>Ingresa el c&oacute;digo</strong> que aparece en la App Banca M&oacute;vil Empresas.</span></li></ol></div><div :class="isContingency && initialParent == \'service\' ? \'container-try-again\' : \'\'" :style="isContingency && initialParent == \'service\' ? { borderRadius: \'9px\', border: \'1px solid #FABB13 !important\' } : {}"><div class="d-flex mt-3 margin-left-text-soft" v-if="invalidSoft"><i class="error_msg mr-2" /><span class="msg_invalid_soft">C&oacute;digo invalido, intenta de nuevo</span></div><vue-otp-2 id="otpInput"ref="otp":length="lengthSoft"class="mt-3 mb-3":class="{disabledOtp:disabledInputSoft}"inputmode="numeric"@onChange="otpValue"pattern="[0-9]"/><span v-if="!isContingency" class="display-inline-table text-soft text-left margin-left-text-soft">Tienes <strong>3 minutos</strong> para poder verificarlo, agotado ese per&iacute;odo de tiempo se cerrar&aacute; tu sesi&oacute;n.</span><div class="container-try-again size-content-new-try-push contingency-progress-bar" v-if="isContingency" :style="isContingency && initialParent == \'service\' && !isUx ? { width: \'414px !important\' } : {}"><div v-html="\'Tienes <strong>3 minutos</strong> para verificarlo antes de que la sesi&oacute;n se cierre.\'" class="msg-try-again" :class="isContingency ? \'text-center\' : \'text-left\'"></div><b-progress class="mt-2 prog-try-again size-prog-try-again-push" :max="maxProgress"><b-progress-bar :value="progress" variant="warning"></b-progress-bar></b-progress></div></div></div></div></div><div v-if="cancelShow" class="mt-3 d-flex justify-content-center buttons-container paddingTokenPassAvv token-challange-buttons"><b-button type="button"@click.prevent="cancelClick()"class="buttonTx buttonCancel buttonAvvTx ui-button-cancel"variant="link" size="l"tabindex="3"><icon v-show="bankVerifyIcon()" class="ui-flowbutton-icon iconInternas"></icon>Cancelar</b-button> <b-button v-if="step==\'3\'" type="button" :disabled="disabledSoft" @click="validateActionChallenge()" class="buttonTx buttonBtaTxConfirm spaceButtonLeft ui-button-next3 d-flex pt-softToken"variant="primary" size="s"><icon v-show="bankVerifyIcon()" class="ui-flowbutton-icon iconInternas iconConfirmSoft"></icon>Confirmar</b-button></div></div>',data:function(){return{actionChallengeInterval:"",loadintervalTkn:"",completeTimeWorker:"",timeTryAgainWorker:"",max:"32",time:"32",timeLess:0,msgTryAgain:"",lengthSoft:"8",completeTimeLess:0,maxProgress:"180",progress:"",noData:false,timeNewTry:true,showNewTry:true,msgEllipseProgress:"",imgCodeQr:"",disabledSoft:true,disabledInputSoft:false,invalidSoft:false,setStepFinish:false,newRedesign:{},valSoft:[],urlGetActionGroupComplement:"/icbs-web/AjaxTx?AID=GET_VALUES_VIRTUAL_TOKEN-0000&RQE=FAC0019C79B6357F&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetMenuId:"/icbs-web/AjaxTx?AID=GET_VALUES_VIRTUAL_TOKEN-0001&RQE=FAC0019C79B63580&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetResult:"/icbs-web/AjaxTx?AID=GET_XML_CHALLENGE_TOKEN-0000&RQE=FAC0019C79B63581&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetSvcData:"/icbs-web/AjaxTx?AID=GET_XML_CHALLENGE_TOKEN-0001&RQE=FAC0019C79B63582&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetStep:"/icbs-web/AjaxTx?AID=GET_XML_CHALLENGE_TOKEN-0002&RQE=FAC0019C79B63583&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetQrBase64:"/icbs-web/AjaxTx?AID=GET_XML_CHALLENGE_TOKEN-0004&RQE=FAC0019C79B63584&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetVtkGenerated:"/icbs-web/AjaxTx?AID=GET_XML_CHALLENGE_TOKEN-0008&RQE=FAC0019C79B63585&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetStatusResponse:"/icbs-web/AjaxTx?AID=ERROR_GRAL_RESPONSE_PUBLIC-1450&RQE=FAC0019C79B63586&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetVerifyService:"/icbs-web/Ajax?AID=CONFIRM_VIRTUAL_TOKEN_VERIFY_TRANSACTION&RQE=FAC0019C79B63587&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),urlGetVerifyLogin:"/icbs-web/Ajax?AID=LOGIN_VIRTUAL_TOKEN_VERIFY&RQE=FAC0019C79B63588&CRFT=fac0019c79b6348e".replace("MID=20108","MID="+menuId),isContingency:false,isTimeComplete:false,isBlocked:false,success:{StatusCode:"EXI",StatusCodeAlt:"000000",StatusDescAlt:"OK",StatusCodeHostSeverity:"OK",StatusCodeError:"000000"},errorDemoService:{StatusCode:"REC",StatusCodeAlt:"300254",StatusDescAlt:"Estimado usuario, se ha superado el tiempo para aprobar la transacci&oacute;n."},errorDemoLogin:{StatusCode:"REC",StatusCodeAlt:"300255",StatusDescAlt:"Se ha superado el tiempo para aprobar el ingreso al Portal."},errorLastAuth:{StatusCode:"REC",StatusCodeAlt:"300256",StatusDescAlt:"No es posible procesar la transacci&oacute;n. Comun&iacute;quese con el usuario administrador"}}},props:{step:{type:String,"default":"1"},extraParams:{type:String,"default":"",},initialParent:{type:String,"default":"login"},path:{type:Object,required:true,},"vtk-group-complement":{type:Boolean,"default":false},confirmActionTx:{type:String,"default":""},"cancel-show":{type:Boolean,"default":true},"size-ellipse":{type:String,"default":"32"},"is-ux":{type:Boolean,"default":true},bank:{type:String,"default":""}},created:function(){this.completeTimeWorker=new Worker(completeTimeURL);this.timeTryAgainWorker=new Worker(timeTryAgainURL);this.finishAllInterval();if(this.isUx&&this.initialParent!="login"){this.newRedesign={newRedesign:"1"}}if(this.initialParent=="service"){for(index in this.path){this.path[index]=this.replaceMidUrl(this.path[index])}}var a=syncAjaxLoadText({url:this.path.contingency});this.isContingency=a==="true"},mounted:function(){setTimeout(function(){this.setStep()}.bind(this),200)},watch:{step:function(a){if(a=="3"){this.$nextTick(function(){$("#otpInput > div").each(function(b,c){if(c.children[0].tagName=="INPUT"){c.children[0].setAttribute("pos",b/2)}});$("#otpInput input").on("keydown",function(b){if(b.key==="Backspace"||b.key==="Delete"){this.valSoft.splice(parseInt(b.target.getAttribute("pos")),this.valSoft.length);this.disabledSoft=true;this.$emit("disabled-btn-accept",this.disabledSoft)}}.bind(this))})}this.$emit("action-step-challenge",a)},setStepFinish:function(a){if(a){this.timeComplete();this.timeNewTryFunc();if(this.step=="1"||this.step=="2"){this.actionChallenge()}}}},methods:{upperFirstChar:function(a){return a[0].toUpperCase()+a.substring(1)},otpValue:function(a){if(a.index==0&&this.invalidSoft){this.invalidSoft=false}this.valSoft[a.index]=a.value;if(this.valSoft.length==this.lengthSoft&&a.index<this.lengthSoft-1){this.valSoft.splice(a.index+1)}this.disabledSoft=this.valSoft.length<this.lengthSoft;this.$emit("disabled-btn-accept",this.disabledSoft)},replaceActionComplement:function(){if(this.vtkGroupComplement){this.path.actionPushQr=this.replaceVirtual(this.path.actionPushQr,this.path.actionPushQr.split("&")[0].split("=")[1]);this.path.actionSoft=this.replaceVirtual(this.path.actionSoft,this.path.actionSoft.split("&")[0].split("=")[1])}},replaceVirtual:function(c,d){var b=syncAjaxLoadText({url:this.urlGetActionGroupComplement});var a=syncAjaxLoadText({url:this.urlGetMenuId});if(typeof b=="undefined"){b=""}if(typeof a=="undefined"){a="";if(menuId!=undefined){a=menuId}}if(a!=""&&!c.includes("MID="+a)){c=c.replace(/MID=[0-9]+/,"MID="+a+"")}if(c.indexOf("MID=206&")!="-1"){c=c.replace("MID=206","MID=20601")}if(c.includes(b)){return c}else{return c.replace(d,d+b)}},replaceMidUrl:function(a){if(a.indexOf("MID=20108")!="-1"){a=a.replace("MID=20108","MID="+menuId)}else{if(a.indexOf("MID=02001")!="-1"){a=a.replace("MID=02001","MID="+menuId)}else{if(a.indexOf("MID=02002")!="-1"){a=a.replace("MID=02002","MID="+menuId)}else{if(a.indexOf("MID=02003")!="-1"){a=a.replace("MID=02003","MID="+menuId)}}}}return a},setStep:function(){if(this.initialParent=="service"){var a="";this.initExtraParams();if(this.confirmActionTx!=""){this.extraParams.vtkConfirmActionTx=this.confirmActionTx}this.$refs.spinnerChallenge.startSpinnerVue();clearInterval(this.loadintervalTkn);this.loadintervalTkn=setInterval(function(){if($("#overlay-background").is(":visible")){clearInterval(this.loadintervalTkn);$.extend(this.extraParams,this.newRedesign);if(this.isUx){if(this.path.push.indexOf("MID=206&")!="-1"){this.path.push=this.path.push.replace("MID=206","MID=20601")}else{if(menuId){this.path.push=this.path.push.replace(/MID=[0-9]+/,"MID="+menuId+"")}}this.initExtraParams();if(typeof this.extraParams.newRedesign=="undefined"){this.extraParams.newRedesign=1}b=syncAjaxLoadText({url:this.path.push,params:this.extraParams})}else{b=syncAjaxLoadText({url:this.urlGetStep,params:this.extraParams});if(b=="1"||b=="2"||b=="3"){var c=syncAjaxLoadText({url:this.urlGetStatusResponse,params:this.extraParams});if(typeof c.Status!="undefined"){c=c.Status[c.Status.length-1];if(c.StatusCodeAlt=="208"){b=c.StatusCodeAlt}}}}if(b=="208"){this.setStepValidateAction();this.validateVerify()}else{if(b=="1"||b=="2"||b=="3"){this.step=b;this.setMsgStep();this.replaceActionComplement();if(this.step=="3"&&!this.isContingency){this.timeTryAgainWorker.postMessage({action:"stop"});clearInterval(this.actionChallengeInterval);clearInterval(this.loadintervalTkn);this.timeComplete()}if(this.isContingency){this.nextStep()}this.$emit("action-step-challenge",this.step)}else{if(typeof b=="undefined"){var b=syncAjaxLoadText({url:this.urlGetSvcData})}this.$emit("action-challenge",b)}}if(!this.isContingency){this.finishSpinner()}this.setStepFinish=true}}.bind(this),100)}else{var a=syncAjaxLoadText({url:this.urlGetSvcData});this.setMsgStep();this.replaceActionComplement();if(a.Status&&a.Status[0].StatusCode!="EXI"){this.$emit("action-challenge",a.Status)}if(this.isContingency){this.nextStep()}this.setStepFinish=true}},validateVerify:function(){var f="";var g=true;if(this.step=="1"){var b=syncAjaxLoadText({url:this.urlGetVtkGenerated});g=(g&&b=="false")}if(this.initialParent=="service"){if(g){f=syncAjaxLoadText({url:this.urlGetVerifyService,params:{trxStatus:true}})}}else{if(this.initialParent=="login"){if(g){f=syncAjaxLoadText({url:this.urlGetVerifyLogin,params:{trxStatus:true}})}}}var e=syncAjaxLoadText({url:this.urlGetSvcData});var d=e.Status;if(Array.isArray(d)){d=d[d.length-1]}if(typeof f!="undefined"){if(f=="A"){if(this.initialParent=="login"||(this.initialParent=="service"&&!this.isUx)){this.$emit("action-challenge",this.success)}else{if(this.initialParent=="service"&&this.isUX){var c="-0100";if(this.step=="1"||this.step=="2"){var a=syncAjaxLoadText({url:this.path.actionPushQr.replace(this.path.actionPushQr.split("&")[0].split("=")[1],this.path.actionPushQr.split("&")[0].split("=")[1]+c),params:this.newRedesign});this.$emit("action-challenge",a)}else{if(this.step=="3"){this.$refs.spinnerChallenge.startSpinnerVue();clearInterval(this.loadintervalTkn);this.loadintervalTkn=setInterval(function(){if($("#overlay-background").is(":visible")){clearInterval(this.loadintervalTkn);var i={cmbvtkSoftTokenData:this.valSoft.toString().replaceAll(",","")};$.extend(i,this.newRedesign);var h=syncAjaxLoadText({url:this.path.actionSoft.replace(this.path.actionSoft.split("&")[0].split("=")[1],this.path.actionSoft.split("&")[0].split("=")[1]+c),params:i});this.$emit("action-challenge",h)}}.bind(this),100)}}}}}else{this.$emit("action-challenge",d)}}},setMsgStep:function(){switch(this.step){case"1":if(this.initialParent=="login"){this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y valida el inicio de sesi&oacute;n"}else{if(this.initialParent=="service"){if(this.isUx){this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y valida esta operaci&oacute;n"}else{this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y autoriza esta operaci&oacute;n"}}}break;case"2":if(this.initialParent=="login"){if(this.isContingency&&this.bank=="BBTA"){this.msgEllipseProgress="Estimado Cliente:<br /><br /><strong>Tenemos intermitencias. Para validar tu inicio de sesi&oacuten abre tu AppM&oacutevil</strong>. Escanea el c&oacutedigo QR e ingresa el c&oacutedigo de verificaci&oacuten para verificar tu identidad.<br /><br />Tienes 3 minutos para completar el proceso; de lo  contrario la sesi&oacuten se cerrar&aacute y deber&aacutes volver a comenzar."}else{if(this.isContingency&&this.bank!="BBTA"){this.msgEllipseProgress="Estimado Cliente:<br /><br />En este momento presentamos intermitencia en nuestros servicios virtuales. Para validar el inicio de sesi&oacuten abre tu <strong>AppM&oacutevil</strong>, escanea este c&oacutedigo QR y confirma la operaci&oacuten ingresando el c&oacutedigo de verificaci&oacuten.<br /><br />Tienes 3 minutos para completar el proceso; de lo contrario la sesi&oacuten se cerrar&aacute y deber&aacutes volver a comenzar."}else{this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y valida el inicio de sesi&oacute;n escaneando este c&oacute;digo"}}}else{if(this.initialParent=="service"){if(this.isContingency){this.msgEllipseProgress="En este momento  presentamos intermitencia en nuestros servicios virtuales. Abre tu <strong>AppM&oacutevil</strong> y autoriza esta operaci&oacuten escaneando este c&oacutedigo QR e ingresando el c&oacutedigo de verificaci&oacuten."}else{this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y autoriza esta operaci&oacute;n escaneando este c&oacute;digo"}}}var a=syncAjaxLoadText({url:this.urlGetQrBase64});if(typeof a=="string"){this.imgCodeQr=a}break;case"3":if(this.isContingency){if(this.initialParent=="login"){this.msgEllipseProgress="<strong>Presentamos intermitencias en nuestros servicios virtuales,</strong> para validar el inicio de sesi&oacute;n, por favor, sigue estos pasos:"}else{this.msgEllipseProgress="<strong>Presentamos intermitencias en nuestros servicios virtuales,</strong> para confirmar la operaci&oacute;n, por favor, sigue estos pasos:"}}else{this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> para acceder a tu c&oacute;digo de verificaci&oacute;n de 8 d&iacute;gitos"}break}},actionChallenge:function(){clearInterval(this.actionChallengeInterval);this.actionChallengeInterval=setInterval(function(){this.validateActionChallenge()}.bind(this),"2000")},setStepValidateAction:function(){var a=syncAjaxLoadText({url:this.urlGetStep});if(a=="1"||a=="2"||a=="3"){this.step=a;this.$emit("action-step-challenge",this.step)}},validateActionChallenge:function(){if(this.step=="1"||this.step=="2"){var a=syncAjaxLoadText({url:this.path.actionPushQr,params:this.newRedesign});if(typeof a=="undefined"||a=="null"){this.finishAllInterval()}if(this.isblock(a)){this.blockVirtualToken(a)}else{this.$emit("action-challenge",a)}}else{if(this.step=="3"){this.$refs.spinnerChallenge.startSpinnerVue();clearInterval(this.loadintervalTkn);this.loadintervalTkn=setInterval(function(){if($("#overlay-background").is(":visible")){clearInterval(this.loadintervalTkn);var c={cmbvtkSoftTokenData:this.valSoft.toString().replaceAll(",","")};$.extend(c,this.newRedesign);var b=syncAjaxLoadText({url:this.path.actionSoft,params:c});if(b.StatusCode=="0"){b=syncAjaxLoadText({url:this.urlGetSvcData})}else{if((b.ModuleResponseError&&b.ModuleResponseError.statusCode=="9999069")||(typeof b.newData!="undefined"&&menuId=="211")){b.statusCode="000000"}}if((b.Envelope&&b.Envelope[0].Status&&b.Envelope[0].Status[0].StatusCode=="0")||b.statusCode=="000000"||(b.Status&&b.Status[0].StatusCode=="000000")||(b.Status&&b.Status[0].StatusCode=="EXI")||b=="000"||b=="0"||b.validateStatus=="000"||b.StatusCode=="EXI"){this.invalidSoft=false;this.$emit("action-challenge",b);this.finishSpinner();return true}else{if(this.isblock(b)){this.blockVirtualToken(b)}else{if(b.StatusCodeAlt!="300173"){this.$emit("action-challenge",b);this.finishSpinner();var d=this;setTimeout(function(){d.step="3";d.disabledInputSoft=true},100);return false}}this.cleanSoftToken();this.finishSpinner();return false}}}.bind(this),100)}}},isblock:function(a){this.isBlocked=(a.StatusCodeAlt=="300172"||a.statusCode=="300172"||(a.Status&&a.Status[0].StatusCodeAlt=="300174"));return this.isBlocked},blockVirtualToken:function(a){this.$emit("action-challenge",a);if(this.step=="3"){syncAjaxLoadText({url:this.path.cancel.replace("AjaxTx","Ajax")})}this.finishSpinner();logoutWithAllLinks()},cleanSoftToken:function(){this.invalidSoft=true;this.disabledSoft=true;this.valSoft=[];this.$refs.otp.clearAfterInput(0);this.$emit("disabled-btn-accept",this.disabledSoft)},nextStep:function(){switch(this.step){case"1":this.$refs.spinnerChallenge.startSpinnerVue();clearInterval(this.loadintervalTkn);this.loadintervalTkn=setInterval(function(){if($("#overlay-background").is(":visible")){clearInterval(this.loadintervalTkn);this.step="2";if(this.initialParent=="login"){this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y valida el inicio de sesi&oacute;n escaneando este c&oacute;digo"}else{if(this.initialParent=="service"){this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y autoriza esta operaci&oacute;n escaneando este c&oacute;digo"}}this.timeComplete();this.timeNewTryFunc();this.actionChallenge();this.showNewTry=true;var a=syncAjaxLoadText({url:this.path.qr,params:this.newRedesign});if(a=="208"){this.validateVerify()}else{if(a=="2"){this.imgCodeQr=syncAjaxLoadText({url:this.urlGetQrBase64})}else{if(a=="3"){this.nextStep()}else{this.$emit("action-challenge",a)}}}this.finishSpinner()}}.bind(this),100);break;case"2":this.$refs.spinnerChallenge.startSpinnerVue();clearInterval(this.loadintervalTkn);this.loadintervalTkn=setInterval(function(){if($("#overlay-background").is(":visible")){clearInterval(this.loadintervalTkn);this.step="3";if(this.isContingency){if(this.initialParent=="login"){this.msgEllipseProgress="<strong>Presentamos intermitencias en nuestros servicios virtuales,</strong> para validar el inicio de sesi&oacute;n, por favor, sigue estos pasos:"}else{this.msgEllipseProgress="<strong>Presentamos intermitencias en nuestros servicios virtuales,</strong> para confirmar la operaci&oacute;n, por favor, sigue estos pasos:"}}else{this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> para acceder a tu c&oacute;digo de verificaci&oacute;n de 8 d&iacute;gitos"}this.timeTryAgainWorker.postMessage({action:"stop"});clearInterval(this.actionChallengeInterval);this.timeComplete();var a=syncAjaxLoadText({url:this.path.soft,params:this.newRedesign});if(a=="208"){this.validateVerify()}else{if(a.StatusCode=="REC"||(a.Status&&a.Status.StatusCode=="999001")||(a.Status&&a.Status[0]&&a.Status[0].StatusCode=="202")||a!="3"){var b=this;setTimeout(function(){b.step="2"},100);this.msgEllipseProgress="Abre tu <strong>AppMovil</strong> y autoriza esta operaci&oacute;n escaneando este c&oacute;digo";this.$emit("action-challenge",a)}}this.finishSpinner()}}.bind(this),100);break;default:this.disabledSoft=true;this.disabledInputSoft=true;if(this.initialParent=="service"){this.$emit("action-challenge",this.errorDemoService);this.cancelClick()}else{if(this.initialParent=="login"){this.$emit("action-challenge",this.errorDemoLogin)}}this.$nextTick(function(){this.step="3"});break}},timeNewTryFunc:function(){this.timeTryAgainWorker.postMessage({action:"stop"});this.timeLess=0;this.timeNewTry=true;var a=this;this.timeTryAgainWorker.onmessage=function(c){var b=c.data;if(b.response=="finish"){a.timeNewTry=false}a.msgTryAgain=b.msgTryAgain;a.time=b.time;a.timeLess=b.timeLess};this.timeTryAgainWorker.postMessage({action:"start",time:this.time,timeLess:this.timeLess,isContingency:this.isContingency,})},timeComplete:function(){this.completeTimeWorker.postMessage({action:"stop"});this.progress="180";this.completeTimeLess=0;this.noData=false;var a=this;this.completeTimeWorker.onmessage=function(c){var b=c.data;if(b.response=="finish"){if(a.isContingency){a.isTimeComplete=true;if(a.initialParent=="login"){a.msgEllipseProgress="<strong>Presentamos intermitencias en nuestros servicios virtuales,</strong> para validar el inicio de sesi&oacute;n, por favor, sigue estos pasos:"}else{a.msgEllipseProgress="<strong>Presentamos intermitencias en nuestros servicios virtuales,</strong> para confirmar la operaci&oacute;n, por favor, sigue estos pasos:"}a.step="3"}a.noData=true;a.nextStep()}else{a.progress=b.progress}};this.completeTimeWorker.postMessage({action:"start",maxProgress:this.maxProgress,completeTimeLess:this.completeTimeLess,progress:this.progress,noData:this.noData})},cancelClick:function(){this.finishAllInterval();var a=syncAjaxLoadText({url:this.path.cancel});this.$emit("on-cancel-challenge",a)},cancelStep:function(){this.$refs.spinnerChallenge.startSpinnerVue();this.finishAllInterval();var a=syncAjaxLoadText({url:this.urlGetResult});if(a!="000"&&a!="300"){syncAjaxLoadText({url:this.path.cancel})}this.finishSpinner()},finishSpinner:function(){if(typeof this.$refs.spinnerChallenge!="undefined"){this.$refs.spinnerChallenge.finishSpinnerVue()}else{setTimeout(function(){$("#overlay-background").hide()},200)}},getMsgError:function(a){if(typeof a.Envelope!="undefined"){return"("+a.Envelope[0].Status[0].StatusCode+") "+a.Envelope[0].Status[0].StatusDesc}else{if(typeof a.Status!="undefined"){return"("+a.Status.StatusCode+") Problemas T&eacute;cnicos, comun&iacute;quese con la Entidad."}else{if(a.StatusCode=="REC"){return"("+a.StatusCodeAlt+") "+a.StatusDescAlt}else{if(a.statusCode){return"("+a.statusCode+") "+a.messageError}else{return"("+a.StatusCode+") "+a.StatusDescAlt}}}}},finishAllInterval:function(){if(this.actionChallengeInterval){clearInterval(this.actionChallengeInterval);this.actionChallengeInterval=null}if(this.loadintervalTkn){clearInterval(this.loadintervalTkn);this.loadintervalTkn=null}if(this.completeTimeWorker){this.completeTimeWorker.postMessage({action:"stop"})}if(this.timeTryAgainWorker){this.timeTryAgainWorker.postMessage({action:"stop"})}},newTry:function(){this.timeComplete();this.showNewTry=false;this.timeNewTryFunc();var a="";this.$refs.spinnerChallenge.startSpinnerVue();clearInterval(this.loadintervalTkn);this.loadintervalTkn=setInterval(function(){if($("#overlay-background").is(":visible")){clearInterval(this.loadintervalTkn);switch(this.step){case"1":a=syncAjaxLoadText({url:this.path.push,params:this.newRedesign});break;case"2":a=syncAjaxLoadText({url:this.path.qr,params:this.newRedesign});break;case"3":if(this.isContingency){a=syncAjaxLoadText({url:this.path.qr,params:this.newRedesign})}a=syncAjaxLoadText({url:this.path.soft,params:this.newRedesign});break}this.finishSpinner();if(a=="208"){this.validateVerify()}else{if((a!="1"&&a!="2"&&a!="3")||a.StatusCode=="REC"){this.$emit("action-challenge",a);var c=this;var b=this.step;setTimeout(function(){c.step=b},100)}else{if(this.step=="2"||(this.isContingency&&this.step=="3")){this.imgCodeQr=syncAjaxLoadText({url:this.urlGetQrBase64})}}}}}.bind(this),100)},initExtraParams:function(){if(typeof this.extraParams=="undefined"||this.extraParams==null||this.extraParams==""){this.extraParams={}}}},computed:{timeTryAgain:function(){return this.time-this.timeLess},tasksDonePercent:function(){return(this.progress*100)/this.maxProgress},}});var completeTimeURL=URL.createObjectURL(new Blob(["(",function(){var a="";self.addEventListener("message",function(c){var d=c.data;var b=c.data.action;if(b==="start"){a=setInterval(function(){d.progress=d.maxProgress-d.completeTimeLess;if(d.completeTimeLess==d.maxProgress){clearInterval(a);self.postMessage({response:"finish"})}else{d.completeTimeLess++}self.postMessage({response:"continue",progress:d.progress})}.bind(d),1000)}else{if(b==="stop"){clearInterval(a)}}})}.toString(),")()"],{type:"application/javascript"}));var timeTryAgainURL=URL.createObjectURL(new Blob(["(",function(){var a="";self.addEventListener("message",function(c){var d=c.data;var b=c.data.action;if(b==="start"){if(d.isContingency){d.timeLess=d.time}a=setInterval(function(){d.msgTryAgain="En <strong>{time} segundos</strong> podras intentar nuevamente".replace("{time}",(d.time-d.timeLess));if(d.timeLess==d.time){clearInterval(a);self.postMessage({response:"finish",msgTryAgain:d.msgTryAgain,time:d.time,timeLess:d.timeLess})}else{d.timeLess++}self.postMessage({response:"continue",msgTryAgain:d.msgTryAgain,time:d.time,timeLess:d.timeLess})}.bind(d),1000)}else{if(b==="stop"){clearInterval(a)}}})}.toString(),")()"],{type:"application/javascript"}));